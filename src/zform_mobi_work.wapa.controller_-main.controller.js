sap.ui.define(["./BaseController", "sap/m/MessageBox",                                                                                                                                                                                                         
	"sap/ui/core/ValueState", "sap/ui/core/Fragment",                                                                                                                                                                                                             
	"sap/ui/model/Filter", "sap/ui/model/FilterOperator",                                                                                                                                                                                                         
	"sap/m/MessageToast"], function (BaseController,                                                                                                                                                                                                              
		MessageBox,                                                                                                                                                                                                                                                  
		ValueState,                                                                                                                                                                                                                                                  
		Fragment,                                                                                                                                                                                                                                                    
		Filter,                                                                                                                                                                                                                                                      
		FilterOperator,                                                                                                                                                                                                                                              
		MessageToast) {                                                                                                                                                                                                                                              
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	return BaseController.extend("com.steb.mobileWork.controller.Main", {                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * @override                                                                                                                                                                                                                                                 
		 */                                                                                                                                                                                                                                                          
		onBeforeRendering: function () {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			this.getRouter().getRoute("display").attachMatched(() => this.getModel("settings").setProperty("/isEditMode", false))                                                                                                                                       
			this.getRouter().getRoute("detail").attachMatched(() => this.getModel("settings").setProperty("/isEditMode", false))                                                                                                                                        
			this.getRouter().getRoute("create").attachMatched(() => this.getModel("settings").setProperty("/isEditMode", true))                                                                                                                                         
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onAfterRendering: function () {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			// const firstApproverKey = this.getView().getModel("shared").createKey("/approvers", {                                                                                                                                                                     
			// 	employeeNumber: "00000006",                                                                                                                                                                                                                             
			// 	type: 'M'                                                                                                                                                                                                                                               
			// })                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			// const secondApproverKey = this.getView().getModel("shared").createKey("/approvers", {                                                                                                                                                                    
			// 	employeeNumber: "00000006",                                                                                                                                                                                                                             
			// 	type: 'MM'                                                                                                                                                                                                                                              
			// })                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			// const thirdApproverKey = this.getView().getModel("shared").createKey("/approvers", {                                                                                                                                                                     
			// 	employeeNumber: "00000007",                                                                                                                                                                                                                             
			// 	type: 'C'                                                                                                                                                                                                                                               
			// })                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			// this.byId("firstApproverInput").bindElement({                                                                                                                                                                                                            
			// 	path: firstApproverKey,                                                                                                                                                                                                                                 
			// 	model: "shared"                                                                                                                                                                                                                                         
			// })                                                                                                                                                                                                                                                       
			// this.byId("secondApproverInput").bindElement({                                                                                                                                                                                                           
			// 	path: secondApproverKey,                                                                                                                                                                                                                                
			// 	model: "shared"                                                                                                                                                                                                                                         
			// })                                                                                                                                                                                                                                                       
			// this.byId("thirdApproverInput").bindElement({                                                                                                                                                                                                            
			// 	path: thirdApproverKey,                                                                                                                                                                                                                                 
			// 	model: "shared"                                                                                                                                                                                                                                         
			// })                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			// this.byId("approverContainer").bindElement({                                                                                                                                                                                                             
			// 	path: approversKey,                                                                                                                                                                                                                                     
			// 	model: "shared"                                                                                                                                                                                                                                         
			// })                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			this.getRouter().getRoute("detail").attachMatched((event) => {                                                                                                                                                                                              
				this._is_inbox = true                                                                                                                                                                                                                                      
				this.byId("container").addStyleClass("sapUiLargeMarginBottom")                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				// substring 5 um FORM_ von id zu entfernen                                                                                                                                                                                                                
				const workitemId = event.getParameter("arguments").wfInstanceId.substring(5)                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				const key = this.getView().getModel("main").createKey("/dataSet", {                                                                                                                                                                                        
					headerId: workitemId,                                                                                                                                                                                                                                     
					employeeNumber: "00000000",                                                                                                                                                                                                                               
					beginDate: new Date("1970-01-01"),                                                                                                                                                                                                                        
					endDate: new Date("1970-01-01")                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
				})                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				this.byId("FormDisplay480_12120").bindElement({                                                                                                                                                                                                            
					path: key + '?$expand=includeSubstituteName',                                                                                                                                                                                                             
					model: "main",                                                                                                                                                                                                                                            
					parameters: { expand: 'includeSubstituteName' },                                                                                                                                                                                                          
					// expand: 'includeSubstituteName'                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
				})                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				this.byId("agreedCheckbox").setSelected(true)                                                                                                                                                                                                              
				this.byId("page").setShowNavButton(false)                                                                                                                                                                                                                  
			})                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			this.getRouter().getRoute("create").attachMatched(() => {                                                                                                                                                                                                   
				this.byId("page").setShowNavButton(true)                                                                                                                                                                                                                   
				// default werte hinterlegen                                                                                                                                                                                                                               
				//Zeitraum von 1970-01-01-1970-01-01, heiÃŸt neues Formular wird erstellt und es werden Defaultwerte mitgegeben                                                                                                                                             
				const key = this.getView().getModel("main").createKey("/dataSet", {                                                                                                                                                                                        
					headerId: "0000000000000000",                                                                                                                                                                                                                             
					employeeNumber: "00000000",                                                                                                                                                                                                                               
					beginDate: new Date("1970-01-01"),                                                                                                                                                                                                                        
					endDate: new Date("1970-01-01")                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
				})                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				this.byId("FormDisplay480_12120").bindElement({                                                                                                                                                                                                            
					path: key + '?$expand=includeSubstituteName',                                                                                                                                                                                                             
					model: "main",                                                                                                                                                                                                                                            
					parameters: { expand: 'includeSubstituteName' },                                                                                                                                                                                                          
					// expand: 'includeSubstituteName'                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
				})                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				// binding="{path: 'main>/dataSet', parameters: {expand: 'includeSubstituteName'}}"                                                                                                                                                                        
				// this.byId("substituteInput")                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				// this.byId("beginDatePicker").setDateValue(new Date())                                                                                                                                                                                                   
				// this.byId("endDatePicker").setDateValue(new Date().addTwoYears())                                                                                                                                                                                       
				// this.byId("percentInput").setValue("75")                                                                                                                                                                                                                
				this.calculateHours(75)                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			})                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			this.getRouter().getRoute("display").attachMatched((event) => {                                                                                                                                                                                             
				this.byId("page").setShowNavButton(true)                                                                                                                                                                                                                   
				const begin = event.getParameter("arguments")["?query"]?.begin                                                                                                                                                                                             
				const end = event.getParameter("arguments")["?query"]?.end                                                                                                                                                                                                 
				this.isDisplay = true;                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
				const formattedBegin = sap.ui.model.odata.ODataUtils.formatValue(begin, "Edm.DateTime")                                                                                                                                                                    
				const formattedEnd = sap.ui.model.odata.ODataUtils.formatValue(end, "Edm.DateTime")                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				const key = this.getView().getModel("main").createKey("/dataSet", {                                                                                                                                                                                        
					headerId: "0000000000000000",                                                                                                                                                                                                                             
					employeeNumber: "",                                                                                                                                                                                                                                       
					beginDate: begin,                                                                                                                                                                                                                                         
					endDate: end                                                                                                                                                                                                                                              
				})                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				this.byId("FormDisplay480_12120").bindElement({                                                                                                                                                                                                            
					path: key,                                                                                                                                                                                                                                                
					model: "main",                                                                                                                                                                                                                                            
					parameters: { expand: 'includeSubstituteName' },                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				})                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				this.byId("agreedCheckbox").setSelected(true)                                                                                                                                                                                                              
				// this.byId("submitButton").setVisible(false)                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
				// this.byId("FormDisplay480_12120").getFormContainers()                                                                                                                                                                                                   
				// 	.forEach(container => container.getFormElements()                                                                                                                                                                                                      
				// 		.forEach(element => element.getFields().forEach(field => {                                                                                                                                                                                            
				// 			if (field.getMetadata().getElementName() === "sap.m.VBox") {                                                                                                                                                                                         
				// 				field.getItems().forEach(item => item?.setEditable(false))                                                                                                                                                                                          
				// 			} else {                                                                                                                                                                                                                                             
				// 				field?.setEditable(false)                                                                                                                                                                                                                           
				// 			}                                                                                                                                                                                                                                                    
				// 		})))                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			}, this)                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			this.getModel("main").attachRequestCompleted(event => {                                                                                                                                                                                                     
				let employeeNumber;                                                                                                                                                                                                                                        
				if (this._is_inbox) {                                                                                                                                                                                                                                      
					employeeNumber = Object.values(this.getModel("main").oData)[0]?.employeeNumber ?? "00000000"                                                                                                                                                              
				} else {                                                                                                                                                                                                                                                   
					employeeNumber = JSON.parse(event.getParameter("response")?.responseText)?.d?.employeeNumber ?? "00000000"                                                                                                                                                
				}                                                                                                                                                                                                                                                          
				const bindApprover = (field, type) => {                                                                                                                                                                                                                    
					const key = this.getView().getModel("shared").createKey("/approvers", {                                                                                                                                                                                   
						employeeNumber,                                                                                                                                                                                                                                          
						type                                                                                                                                                                                                                                                     
					})                                                                                                                                                                                                                                                        
					this.byId(field).bindElement({                                                                                                                                                                                                                            
						path: key,                                                                                                                                                                                                                                               
						model: "shared"                                                                                                                                                                                                                                          
					})                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				const personalDataKey = this.getView().getModel("shared").createKey("/personnelDataSet", {                                                                                                                                                                 
					employeeNumber,                                                                                                                                                                                                                                           
				})                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
				this.byId("personalDataContainer").bindElement({                                                                                                                                                                                                           
					path: personalDataKey,                                                                                                                                                                                                                                    
					model: "shared"                                                                                                                                                                                                                                           
				})                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
				bindApprover("firstApproverInput", 'M')                                                                                                                                                                                                                    
				bindApprover("secondApproverInput", 'MM')                                                                                                                                                                                                                  
				bindApprover("thirdApproverInput", 'C')                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			}, this)                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		/// Event handler um maximal 100% zu erlauben                                                                                                                                                                                                                
		/// Ruft auÃŸerdem calculateHours auf                                                                                                                                                                                                                         
		procentGuard: function (event) {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			let value = event.getSource().getValue()                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			value = value > 100 ? 100 : value                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			event.getSource().setValue(value)                                                                                                                                                                                                                           
			this.calculateHours(value)                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
		/// Berechnet die wÃ¶chentlichen Stundenanzahl mit den Prozent                                                                                                                                                                                                
		calculateHours: function (percent) {                                                                                                                                                                                                                         
			const initialHours = this.byId("hoursInput").getValue()                                                                                                                                                                                                     
			const calculatedHours = initialHours * percent / 100;                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			this.byId("calculatedHours").setValue(calculatedHours)                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
		timespanGuard: function (event) {                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
			let beginDateParts = event.getParameter("value").split(".");                                                                                                                                                                                                
			beginDateParts[2] = "20" + beginDateParts[2];                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			const beginDate = new Date(beginDateParts.reverse().join("-"))                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			let maxEndDate = new Date(beginDate)                                                                                                                                                                                                                        
			maxEndDate.setFullYear(maxEndDate.getFullYear() + 2)                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			const endDatePicker = this.byId("endDatePicker")                                                                                                                                                                                                            
			if (endDatePicker.getDateValue() >= maxEndDate) {                                                                                                                                                                                                           
				endDatePicker.setDateValue(maxEndDate)                                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
			else if (endDatePicker.getDateValue() <= beginDate) {                                                                                                                                                                                                       
				endDatePicker.setDateValue(beginDate)                                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		endDateGuard: function (event) {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			const endDate = new Date(event.getParameter("value").split(".").reverse().join("-"))                                                                                                                                                                        
			const beginDate = this.byId("beginDatePicker").getDateValue()                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			let maxEndDate = new Date(beginDate)                                                                                                                                                                                                                        
			maxEndDate.setFullYear(maxEndDate.getFullYear() + 2)                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			if (endDate > maxEndDate) {                                                                                                                                                                                                                                 
				this.byId("endDatePicker").setValueState(ValueState.Error)                                                                                                                                                                                                 
				this.byId("endDatePicker").setValueStateText("Max 2 Jahre mÃ¶glich")                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			else if (endDate < beginDate) {                                                                                                                                                                                                                             
				this.byId("endDatePicker").setValueState(ValueState.Error)                                                                                                                                                                                                 
				this.byId("endDatePicker").setValueStateText("Endedatum muss grÃ¶ÃŸer als Beginndatum sein")                                                                                                                                                                 
			} else {                                                                                                                                                                                                                                                    
				this.byId("endDatePicker").setValueState(ValueState.None)                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		workDaysSelectionChange: function (event) {                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			this.getModel("settings").setProperty("/showFixedDays", event.getParameter("selectedIndex") === 1)                                                                                                                                                          
			// if (this.byId("workDaysCheckbox").getSelected()) {                                                                                                                                                                                                       
			// 	this.byId("workDaysBox").getItems().forEach(item => { item.setEditable(true); item.setSelected(true) })                                                                                                                                                 
			// } else {                                                                                                                                                                                                                                                 
			// 	this.byId("workDaysBox").getItems().forEach(item => { item.setEditable(false); item.setSelected(false) })                                                                                                                                               
			// }                                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
		/// Wird benÃ¶tigt um nach fehlerhaften submit den valuestate zu entfernen                                                                                                                                                                                    
		agreeToMobileWork: function (event) {                                                                                                                                                                                                                        
			event.getSource().setValueState(ValueState.None)                                                                                                                                                                                                            
			event.getSource().setValueStateText("")                                                                                                                                                                                                                     
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		cancel: function () {                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			if (this.isDisplay) {                                                                                                                                                                                                                                       
				this.getOwnerComponent().getRouter().navTo("main")                                                                                                                                                                                                         
				return                                                                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			MessageBox.confirm("Ã„nderungen werden verworfen. MÃ¶chten Sie fortfÃ¼hren?", {                                                                                                                                                                                
				onClose: action => {                                                                                                                                                                                                                                       
					if (action === sap.m.MessageBox.Action.OK) {                                                                                                                                                                                                              
						this.getOwnerComponent().getRouter().navTo("main")                                                                                                                                                                                                       
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
			})                                                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
		/// sends the data to backend                                                                                                                                                                                                                                
		submit: function () {                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			const page = this.byId("page"),                                                                                                                                                                                                                             
				agreedCheckbox = this.byId("agreedCheckbox"),                                                                                                                                                                                                              
				weeklyHours = this.byId("hoursInput").getValue(),                                                                                                                                                                                                          
				beginDatePicker = this.byId("beginDatePicker"),                                                                                                                                                                                                            
				endDatePicker = this.byId("endDatePicker"),                                                                                                                                                                                                                
				substituteInput = this.byId("substituteInput"),                                                                                                                                                                                                            
				percent = this.byId("percentInput").getValue(),                                                                                                                                                                                                            
				flexible = this.byId("flexibleCheckbox").getSelected(),                                                                                                                                                                                                    
				useSpecificWorkdays = this.byId("workDaysCheckbox").getSelected()                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			const agreedToMobileWork = agreedCheckbox.getSelected()                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			if (!agreedToMobileWork) {                                                                                                                                                                                                                                  
				agreedCheckbox.setValueState(ValueState.Error)                                                                                                                                                                                                             
				agreedCheckbox.setValueStateText("Sie mÃ¼ssen das Feld ankreuzen um fortzufahren")                                                                                                                                                                          
				page.scrollToElement(agreedCheckbox)                                                                                                                                                                                                                       
				return                                                                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			const beginDate = beginDatePicker.getDateValue()                                                                                                                                                                                                            
			const endDate = endDatePicker.getDateValue()                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
			if (endDate < beginDate) {                                                                                                                                                                                                                                  
				endDatePicker.setValueState(ValueState.Error)                                                                                                                                                                                                              
				endDatePicker.setValueStateText("Endedatum muss grÃ¶ÃŸer als Beginndatum sein")                                                                                                                                                                              
				page.scrollToElement(endDatePicker)                                                                                                                                                                                                                        
				return                                                                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			const maxEndDate = new Date(beginDate)                                                                                                                                                                                                                      
			maxEndDate.setFullYear(maxEndDate.getFullYear() + 2)                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			if (endDate > maxEndDate) {                                                                                                                                                                                                                                 
				endDatePicker.setValueState(ValueState.Error)                                                                                                                                                                                                              
				endDatePicker.setValueStateText("Max 2 Jahre mÃ¶glich")                                                                                                                                                                                                     
				page.scrollToElement(endDatePicker)                                                                                                                                                                                                                        
				return                                                                                                                                                                                                                                                     
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			// const requestData = {                                                                                                                                                                                                                                    
			// 	employeeNumber: this.byId("pernrInput").getValue(),                                                                                                                                                                                                     
			// 	beginDate,                                                                                                                                                                                                                                              
			// 	endDate,                                                                                                                                                                                                                                                
			// 	flexible,                                                                                                                                                                                                                                               
			// 	useWeekdays: this.byId("workDaysCheckbox").getSelected(),                                                                                                                                                                                               
			// 	// mobileWorkPercent: parseFloat(this.byId("percentInput").getValue()),                                                                                                                                                                                 
			// 	mobileWorkPercent: this.byId("percentInput").getValue(),                                                                                                                                                                                                
			// 	substitute: this.byId("substituteInput").getValue(),                                                                                                                                                                                                    
			// 	weeklyHours,                                                                                                                                                                                                                                            
			// 	monday: this.byId("mondayCheckbox").getSelected(),                                                                                                                                                                                                      
			// 	tuesday: this.byId("tuesdayCheckbox").getSelected(),                                                                                                                                                                                                    
			// 	wednesday: this.byId("wednesdayCheckbox").getSelected(),                                                                                                                                                                                                
			// 	thursday: this.byId("thursdayCheckbox").getSelected(),                                                                                                                                                                                                  
			// 	friday: this.byId("fridayCheckbox").getSelected(),                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
			// }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			const contextPath = this.byId("FormDisplay480_12120").getBindingContext("main").getPath()                                                                                                                                                                   
                                                                                                                                                                                                                                                               
			// this.getModel("main").setProperty(contextPath + '/beginDate', this.byId("beginDatePicker").getValue())                                                                                                                                                   
			// this.getModel("main").setProperty(contextPath + '/endDate', this.byId("endDatePicker").getValue())                                                                                                                                                       
                                                                                                                                                                                                                                                               
			const requestData = this.getModel("main").getProperty(contextPath)                                                                                                                                                                                          
			// beginDate: this.byId("beginDatePicker").getValue(),                                                                                                                                                                                                      
			// endDate: this.byId("endDatePicker").getValue()                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			// vor Erstellung Assoziation lÃ¶schen                                                                                                                                                                                                                       
			delete requestData.includeSubstituteName                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
			this.getView().getModel("main").create("/dataSet", requestData, {                                                                                                                                                                                           
				success: () => {                                                                                                                                                                                                                                           
					this.getModel("main").refresh()                                                                                                                                                                                                                           
					MessageBox.success("Antrag auf mobiles Arbeiten erstellt", { onClose: () => this.getOwnerComponent().getRouter().navTo("main") })                                                                                                                         
                                                                                                                                                                                                                                                               
				}, error: e => { MessageBox.error(e.responseText) }                                                                                                                                                                                                        
			})                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		openSubstituteValueHelp: function (oEvent) {                                                                                                                                                                                                                 
			// var sInputValue = oEvent.getSource().getValue(),                                                                                                                                                                                                         
			// 	oView = this.getView();                                                                                                                                                                                                                                 
			const view = this.getView()                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			if (!this._substituteValueHelpDialog) {                                                                                                                                                                                                                     
				this._substituteValueHelpDialog = Fragment.load({                                                                                                                                                                                                          
					id: view.getId(),                                                                                                                                                                                                                                         
					name: "com.steb.mobileWork.fragments.SubstituteValueHelp",                                                                                                                                                                                                
					controller: this                                                                                                                                                                                                                                          
				}).then(function (oDialog) {                                                                                                                                                                                                                               
					view.addDependent(oDialog);                                                                                                                                                                                                                               
					return oDialog;                                                                                                                                                                                                                                           
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			this._substituteValueHelpDialog.then(function (oDialog) {                                                                                                                                                                                                   
				// Create a filter for the binding                                                                                                                                                                                                                         
				// oDialog.getBinding("items").filter([new Filter("Name", FilterOperator.Contains, sInputValue)]);                                                                                                                                                         
				// Open ValueHelpDialog filtered by the input's value                                                                                                                                                                                                      
				oDialog.open();                                                                                                                                                                                                                                            
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
		onValueHelpClose: function (oEvent) {                                                                                                                                                                                                                        
			var oSelectedItem = oEvent.getParameter("selectedItem");                                                                                                                                                                                                    
			oEvent.getSource().getBinding("items").filter([]);                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			if (!oSelectedItem) {                                                                                                                                                                                                                                       
				return;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			const employeeNumber = oSelectedItem.getDescription(),                                                                                                                                                                                                      
				bindingContext = this.byId("FormDisplay480_12120").getBindingContext("main"),                                                                                                                                                                              
				expandedPath = bindingContext.getPath() + '/includeSubstituteName',                                                                                                                                                                                        
				model = this.getModel("main"),                                                                                                                                                                                                                             
				substitutePath = `/substitutes('${employeeNumber}')`                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			model.setProperty(expandedPath + '/employeeNumber', model.getProperty(substitutePath + '/employeeNumber'))                                                                                                                                                  
			model.setProperty(expandedPath + '/firstName', model.getProperty(substitutePath + '/firstName'))                                                                                                                                                            
			model.setProperty(expandedPath + '/lastName', model.getProperty(substitutePath + '/lastName'))                                                                                                                                                              
			model.setProperty(bindingContext.getPath() + '/substitute', employeeNumber)                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
		onValueHelpSearch: function (oEvent) {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			const value = oEvent.getParameter("value"),                                                                                                                                                                                                                 
				filter = new Filter("firstName", FilterOperator.Contains, value)                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			oEvent.getSource().getBinding("items").filter([filter]);                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               